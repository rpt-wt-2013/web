@model TestWeb.Models.FilesLibrary.WorkingFolder
@using TestWeb.Models.FilesLibrary;
@using TestWeb.MyHelpers;
@{
    ViewBag.Title = "Root";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Script {
    <script src="@Url.Content("~/Scripts/jquery-1.5.1.min.js")" type="text/javascript"></script>    

    <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.min.js")" type="text/javascript"></script>

    <script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>

    <script src="@Url.Content("~/Scripts/MicrosoftAjax.js")" type="text/javascript"></script>

    <script src="@Url.Content("~/Scripts/MicrosoftMvcAjax.js")" type="text/javascript"></script>

    <script src="@Url.Content("~/Scripts/cubi.js")" type="text/javascript"></script>
}
<h2>Root</h2>
@using (Html.BeginForm("Upload", "Browser", FormMethod.Post, new {enctype="multipart/form-data"})){ 

     <input type="file" name="FileUpload1" /><br />
     <input type="submit" name="Submit" id="Submit" value="Upload" />
}
<table style="border-width:medium;">
    <tr>
        <th style="width:250px">
            Name
        </th>
        <th style="width:75px">
            Type
        </th>
        <th style="width:75px">
            Size
        </th>
    <tr>
@foreach (AbstractFile file in Model.GetFiles())
{
    <tr>
    @if (file is Folder)
    {
        <td>
            <a href="@Url.Action("Folder", "Browser", new { @name = file.FullName })">
                <img src="@Url.Content("~/Content/icons/folder24.png")"/>
                @String.Format("[{0}]", file.Name)
            </a>
        </td>
        <td>
            Folder
        </td>
        <td>
            &ltDIR&gt
        </td>
        <td>
            <span onclick ='showFormular(this, "rename")' data-file = "@file.FullName" >rename</span>
        </td>
        <td>
            <span onclick ='showFormular(this, "move")' data-file = "@file.FullName" >move</span>
        </td>
        <td>
            <span onclick ='showFormular(this, "copy")' data-file = "@file.FullName" >copy</span>
        </td>
        <td>
            @Ajax.ActionLink("delete", "DeleteFile", "Browser", new { name = file.FullName},
         new AjaxOptions { Confirm = "Do You really want to delete this file?" })
        </td>
    }
    else
    {
        var type = "";
        var controller = "";
        var action = "";
        var image = "";


        if (file is AudioFile)
        {
            type = "Audio";
            controller = "AudioPlayer";
            action = "EmptyAudioPlayer";
            image = "audio24";
        }
        else if (file is VideoFile)
        {
            type = "Video";
            controller = "VideoPlayer";
            action = "PlayVideo";
            image = "video24";
        }
        else if (file is TextFile)
        {
            type = "Text";
            controller = "TextViewer";
            action = "ViewText";
            image = "text24";
        }
        else if (file is PictureFile)
        {
            type = "Picture";
            controller = "PictureViewer";
            action = "ViewPicture";
            image = "image24";
        }
        else if (file is UnknownFile)
        {
            type = "Other";
            controller = "Browser";
            action = "Download";
            image = "unknown24";
        }
            
            
        <td>
            <a href="@Url.Action(@action, @controller, new { @name = file.FullName })">
                <img src="@Url.Content("~/Content/icons/" + @image + ".png")"/>
                @Path.GetFileNameWithoutExtension(file.Name)
            </a>
        </td>
        <td>
            @type
        </td>
        <td>
            @{ float length = ((FileInfo)file.File).Length; } 
            @if (length < 1024)
            {
                @String.Format("{0} B", length)
            }
            @if (length > 1024 && length < (1024 * 1024))
            { 
                @String.Format("{0} kB", Math.Round((length / 1024), 2))
            }
            @if (length > (1024 * 1024))
            { 
                @String.Format("{0} MB", Math.Round((length / (1024 * 1024)), 2))
            }
        </td>
        <td>
            <span onclick ='showFormular(this, "rename")' data-file = "@file.FullName" >rename</span>
        </td>
        <td>
            <span onclick ='showFormular(this, "move")' data-file = "@file.FullName" >move</span>
        </td>
        <td>
            <span onclick ='showFormular(this, "copy")' data-file = "@file.FullName" >copy</span>
        </td>
        <td>
            @Ajax.ActionLink("delete", "DeleteFile", "Browser", new { name = file.FullName},
         new AjaxOptions { Confirm = "Do You really want to delete this file?" })
        </td>
    }
    </tr>
}
</table>
<div>
    @{Html.RenderAction("RenameFile", "Browser");}
</div>
<div>
    @{Html.RenderAction("MoveFile", "Browser");}
</div>
<div>
    @{Html.RenderAction("CopyFile", "Browser");}
</div>